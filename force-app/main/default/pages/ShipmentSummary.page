<apex:page controller="ShipmentSummaryController" lightningStylesheets="true" showHeader="true" sidebar="true">
    <apex:slds />
    
    <style>
        .brand-color { color: #A6FFCB; }
        .brand-bg { background-color: #A6FFCB; color: #080707; }
        .metric-card {
            border-left: 4px solid #A6FFCB;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .status-pending { background-color: #FFC168; }
        .status-transit { background-color: #A6FFCB; }
        .status-customs { background-color: #FFB75D; }
        .status-delivered { background-color: #4BCA81; }
        .status-cancelled { background-color: #EA001E; }
    </style>
    
    <div class="slds-scope">
        <!-- Page Header -->
        <div class="slds-page-header">
            <div class="slds-page-header__row">
                <div class="slds-page-header__col-title">
                    <div class="slds-media">
                        <div class="slds-media__figure">
                            <span class="slds-icon_container slds-icon-custom-custom18">
                                <svg class="slds-icon slds-page-header__icon" aria-hidden="true">
                                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/apexremote/servlet/servlet.FileDownload?file=015xx000000L9abAAC#custom18"></use>
                                </svg>
                            </span>
                        </div>
                        <div class="slds-media__body">
                            <div class="slds-page-header__name">
                                <div class="slds-page-header__name-title">
                                    <h1>
                                        <span class="slds-page-header__title slds-truncate">Shipment Summary Dashboard</span>
                                    </h1>
                                </div>
                            </div>
                            <p class="slds-page-header__name-meta">Real-time shipment analytics and reporting</p>
                        </div>
                    </div>
                </div>
                <div class="slds-page-header__col-actions">
                    <apex:form >
                        <apex:commandButton value="Refresh Data" action="{!refreshData}" styleClass="slds-button slds-button_brand brand-bg" reRender="summaryPanel,shipmentTable"/>
                    </apex:form>
                </div>
            </div>
        </div>
        
        <!-- Summary Metrics -->
        <apex:outputPanel id="summaryPanel">
            <div class="slds-grid slds-wrap slds-gutters slds-m-top_medium">
                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-4">
                    <article class="slds-card metric-card">
                        <div class="slds-card__body slds-card__body_inner slds-text-align_center">
                            <h3 class="slds-text-heading_large">{!totalShipments}</h3>
                            <p class="slds-text-body_regular">Total Shipments</p>
                        </div>
                    </article>
                </div>
                
                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-4">
                    <article class="slds-card metric-card">
                        <div class="slds-card__body slds-card__body_inner slds-text-align_center">
                            <h3 class="slds-text-heading_large">{!inTransitCount}</h3>
                            <p class="slds-text-body_regular">In Transit</p>
                        </div>
                    </article>
                </div>
                
                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-4">
                    <article class="slds-card metric-card">
                        <div class="slds-card__body slds-card__body_inner slds-text-align_center">
                            <h3 class="slds-text-heading_large">{!pendingCount}</h3>
                            <p class="slds-text-body_regular">Pending</p>
                        </div>
                    </article>
                </div>
                
                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-4">
                    <article class="slds-card metric-card">
                        <div class="slds-card__body slds-card__body_inner slds-text-align_center">
                            <h3 class="slds-text-heading_large">{!deliveredThisMonth}</h3>
                            <p class="slds-text-body_regular">Delivered (Month)</p>
                        </div>
                    </article>
                </div>
            </div>
        </apex:outputPanel>
        
        <!-- Shipment Table -->
        <apex:outputPanel id="shipmentTable">
            <div class="slds-card slds-m-top_medium">
                <div class="slds-card__header slds-grid">
                    <header class="slds-media slds-media_center slds-has-flexi-truncate">
                        <div class="slds-media__body">
                            <h2 class="slds-card__header-title">
                                <span>Recent Shipments</span>
                            </h2>
                        </div>
                    </header>
                </div>
                <div class="slds-card__body slds-card__body_inner">
                    <table class="slds-table slds-table_cell-buffer slds-table_bordered slds-table_striped">
                        <thead>
                            <tr class="slds-line-height_reset">
                                <th scope="col"><div class="slds-truncate">Shipment #</div></th>
                                <th scope="col"><div class="slds-truncate">Status</div></th>
                                <th scope="col"><div class="slds-truncate">Agent</div></th>
                                <th scope="col"><div class="slds-truncate">Departure</div></th>
                                <th scope="col"><div class="slds-truncate">ETA</div></th>
                                <th scope="col"><div class="slds-truncate">Method</div></th>
                                <th scope="col"><div class="slds-truncate">Account</div></th>
                            </tr>
                        </thead>
                        <tbody>
                            <apex:repeat value="{!recentShipments}" var="shipment">
                                <tr>
                                    <td data-label="Shipment">
                                        <div class="slds-truncate">
                                            <a href="/{!shipment.Id}" target="_blank">{!shipment.Name}</a>
                                        </div>
                                    </td>
                                    <td data-label="Status">
                                        <span class="slds-badge status-{!LOWER(SUBSTITUTE(shipment.Status__c, ' ', '-'))}">{!shipment.Status__c}</span>
                                    </td>
                                    <td data-label="Agent">
                                        <div class="slds-truncate">
                                            <apex:outputText value="{!IF(ISBLANK(shipment.Assigned_Agent__r.Name), 'Unassigned', shipment.Assigned_Agent__r.Name)}"/>
                                        </div>
                                    </td>
                                    <td data-label="Departure">
                                        <apex:outputText value="{0, date, MMM dd, yyyy}">
                                            <apex:param value="{!shipment.Departure_Date__c}"/>
                                        </apex:outputText>
                                    </td>
                                    <td data-label="ETA">
                                        <apex:outputText value="{0, date, MMM dd, yyyy}">
                                            <apex:param value="{!shipment.ETA__c}"/>
                                        </apex:outputText>
                                    </td>
                                    <td data-label="Method">
                                        <div class="slds-truncate">{!shipment.Shipping_Method__c}</div>
                                    </td>
                                    <td data-label="Account">
                                        <div class="slds-truncate">
                                            <apex:outputText value="{!IF(ISBLANK(shipment.Account__r.Name), '-', shipment.Account__r.Name)}"/>
                                        </div>
                                    </td>
                                </tr>
                            </apex:repeat>
                        </tbody>
                    </table>
                </div>
            </div>
        </apex:outputPanel>
        
        <!-- Status Distribution -->
        <div class="slds-card slds-m-top_medium">
            <div class="slds-card__header slds-grid">
                <header class="slds-media slds-media_center slds-has-flexi-truncate">
                    <div class="slds-media__body">
                        <h2 class="slds-card__header-title">
                            <span>Status Distribution</span>
                        </h2>
                    </div>
                </header>
            </div>
            <div class="slds-card__body slds-card__body_inner">
                <div class="slds-grid slds-wrap slds-gutters">
                    <apex:repeat value="{!statusBreakdown}" var="status">
                        <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-5">
                            <div class="slds-box slds-box_x-small slds-text-align_center">
                                <p class="slds-text-heading_medium">{!status.count}</p>
                                <p class="slds-text-body_small">{!status.status}</p>
                            </div>
                        </div>
                    </apex:repeat>
                </div>
            </div>
        </div>
    </div>
</apex:page>